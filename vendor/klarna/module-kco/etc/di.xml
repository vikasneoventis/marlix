<?xml version="1.0"?>
<!--
/**
 * This file is part of the Klarna KCO module
 *
 * (c) Klarna Bank AB (publ)
 *
 * For the full copyright and license information, please view the NOTICE
 * and LICENSE files that were distributed with this source code.
 */
-->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <type name="Klarna\Kco\Model\Checkout\Type\Kco">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Klarna\Confirmation">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Klarna\SaveShippingAddress">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Klarna\SaveShippingMethod">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Klarna\SaveMessage">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Klarna\ReloadSummary">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Klarna\SaveCustomer">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Klarna\Index">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Klarna\Failure">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Klarna\ValidateFailed">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Api\AddressUpdate">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Api\CountryLookup">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Api\Disabled">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Api\RetrieveAddress">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Api\ShippingMethodUpdate">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Controller\Api\Validate">
        <arguments>
            <argument name="logger" xsi:type="object">Klarna\Core\Logger\Logger</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Model\System\Config\Source\Merchantcheckbox">
        <arguments>
            <argument name="config" xsi:type="object">Klarna\Core\Config\Virtual</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Model\System\Config\Source\Externalmethods">
        <arguments>
            <argument name="config" xsi:type="object">Klarna\Core\Config\Virtual</argument>
        </arguments>
    </type>
    <type name="Klarna\Kco\Helper\ApiHelper">
        <arguments>
            <argument name="config" xsi:type="object">Klarna\Core\Config\Virtual</argument>
        </arguments>
    </type>

    <!-- Payment Method configuration -->
    <type name="Klarna\Kco\Model\Payment\Kco">
        <arguments>
            <argument name="adapter" xsi:type="object">KcoPaymentAdapter</argument>
        </arguments>
    </type>

    <virtualType name="KcoPaymentAdapter" type="Magento\Payment\Model\Method\Adapter">
        <arguments>
            <argument name="code" xsi:type="const">Klarna\Kco\Model\Payment\Kco::METHOD_CODE</argument>
            <argument name="valueHandlerPool" xsi:type="object">KlarnaValueHandlerPool</argument>
            <argument name="validatorPool" xsi:type="object">KlarnaValidatorPool</argument>
            <argument name="commandPool" xsi:type="object">KlarnaCommandPool</argument>
            <argument name="formBlockType" xsi:type="string">Magento\Payment\Block\Form</argument>
            <argument name="infoBlockType" xsi:type="string">Klarna\Core\Block\Info\Klarna</argument>
        </arguments>
    </virtualType>

    <virtualType name="KlarnaCommandPool" type="Magento\Payment\Gateway\Command\CommandPool">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="initialize" xsi:type="string">Klarna\Kco\Gateway\Command\Initialize</item>
                <!-- Check Ordermanagement module for arguments -->
            </argument>
        </arguments>
    </virtualType>
    <virtualType name="KlarnaConfig" type="Magento\Payment\Gateway\Config\Config">
        <arguments>
            <argument name="methodCode" xsi:type="const">Klarna\Kco\Model\Payment\Kco::METHOD_CODE</argument>
        </arguments>
    </virtualType>
    <virtualType name="KlarnaConfigValueHandler" type="Magento\Payment\Gateway\Config\ConfigValueHandler">
        <arguments>
            <argument name="configInterface" xsi:type="object">KlarnaConfig</argument>
        </arguments>
    </virtualType>
    <virtualType name="KlarnaValueHandlerPool" type="Magento\Payment\Gateway\Config\ValueHandlerPool">
        <arguments>
            <argument name="handlers" xsi:type="array">
                <item name="default" xsi:type="string">KlarnaConfigValueHandler</item>
            </argument>
        </arguments>
    </virtualType>

    <virtualType name="KlarnaValidatorPool" type="Magento\Payment\Gateway\Validator\ValidatorPool">
        <arguments>
            <argument name="validators" xsi:type="array">
                <!-- intentionally empty -->
            </argument>
        </arguments>
    </virtualType>

    <type name="Magento\Checkout\Helper\Data">
        <plugin name="afterIsAllowedGuestCheckout" type="Klarna\Kco\Plugin\CheckoutHelperPlugin" sortOrder="10"/>
    </type>

    <preference for="Klarna\Kco\Api\ApiInterface" type="Klarna\Kco\Model\Api\Kasper" />
    <preference for="Klarna\Kco\Api\QuoteInterface" type="Klarna\Kco\Model\Quote" />
    <preference for="Klarna\Kco\Api\QuoteRepositoryInterface" type="Klarna\Kco\Model\QuoteRepository" />
</config>
